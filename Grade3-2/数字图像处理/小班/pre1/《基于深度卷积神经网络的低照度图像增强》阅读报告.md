# 《基于深度卷积神经网络的低照度图像增强》阅读报告

马红强, 马时平, 许悦雷, 朱明明. 基于深度卷积神经网络的低照度图像增强[J]. 光学学报, 2019, 39(2): 0210004. Hongqiang Ma, Shiping Ma, Yuelei Xu, Mingming Zhu. Low-Light Image Enhancement Based on Deep Convolutional Neural Network[J]. Acta Optica Sinica, 2019, 39(2): 0210004.

## 一、研究内容与研究背景 

### 研究内容：

对于在夜间等低照度环境下拍摄的图像，由于其亮度、对比度较低且含有噪声，不仅肉眼难以分辨，也给后续图像处理(如目标检测、视频监控等)带来了严峻挑战。

该论文针对低照度条件下图像降质严重的问题，如过增强、色彩失真、边缘伪影等问题，提出了一种基于深度卷积神经网络(DCNN)的低照度图像增强算法。论文中将所提算法和主流算法处理后的多组图像进行对比，可以看到所提算法相比其他优势，其处理后的图像在主观视觉和客观评价指标上领先于其他算法。

### 研究背景：

1. **对低照度图像进行图像增强可应用于多个实际场景**，如：
   - 夜间监控：对于人眼或计算机无法分辨的监控图像进行图像增强，提高监控画面的清晰度以及自动目标检测算法的准确率。
   - 自动驾驶：增强车辆夜间摄像头的成像质量，提高自动驾驶系统对道路、交通标志、行人的识别能力
   - 医学成像：提高 X-ray、CT等影像的对比度，帮助医生更精准地观察组织、血管或肿瘤位置，以进行更精准诊断。
2. **现有方法对低照度图像增强的局限性**：
   - 基于直方图均衡化（HE）的方法易导致色偏和细节丢失。
   - Retinex依赖光照分量估计精度，MSR算法会使图像边缘锐化不足,部分颜色发生扭曲，MSRCR 算法使得增强后的图像不会出现失真的现象，但图像的颜色会偏离原始色彩，整体颜色偏白。
   - 基于去雾模型的算法虽能够在一定程度上提高视觉质量,但增强后的图像往往不符合实际场景,且容易在边缘出现伪影。
3. **深度学习技术的发展**：
   - 深度学习技术在图像分类、检测与跟踪等领域取得了巨大成功，为其进行图像处理带来了可能性。
   - 卷积神经网络(CNN)作为深度学习中的代表性模型，凭借其结构优势对处理各种扭曲不变性图像具有良好的稳健性，提取到的深层次特征具有更强的泛化能力。

## **二、核心理论与方法创新** 

作者提出的算法结合Retinex模型和深度卷积神经网络DCNN，其方法框架如下：

1. **颜色空间转换**：将RGB图像转换为HSI（Hue-Saturation-Intensity）颜色空间，仅对亮度分量（I）进行增强，保持色度（H）和饱和度（S）不变，以减少色彩失真。
2. **亮度增强**：采用 DCNN 处理亮度分量，实现低照度图像的亮度增强。
3. **颜色空间逆转换**：将增强后的 HSI 图像转换回 RGB 颜色空间，得到最终的增强图像。

### **模型选择**

- **Retinex模型：** 
  - 函数表示：$$S(x,y) = L(x,y) \cdot R(x,y)$$
  - 方法创新：通过Retinex模型合成训练样本（光照分量 $$ L \sim U(0,1) $$，反射分量 \( R \) 取自Berkeley数据集），解决真实低照度数据不足问题。
- **HSI颜色模型：**
  - 模型特点：色度（H）、饱和度（S）和亮度（I）来表征色彩
  - 方法创新：
    - 分离亮度（I）与色度（H）、饱和度（S），避免直接处理RGB通道的色彩相关性。
    - 仅增强I分量，保持H、S不变，减少色彩失真。

### **神经网络架构设计** 

- **DCNN结构**（7层，无池化、全连接层）：
  - **输入/输出**：40 pixel × 40 pixel图像块（输入输出都为图像的亮度分量I）
  - **特征提取**：3 pixel × 3 pixel × 64 pixel 卷积核+ 非线性激活函数
  - **非线性映射**：多组卷积 （3 pixel × 3 pixel × 64 pixel × 64 pixel）+ 批归一化（BN）+ ReLU，提升收敛稳定性。
  - **重建层**：单卷积核恢复增强后的I分量。
- **关键设计细节**：
  - 将图像分块处理：显著降低单次计算量，使模型可在GPU上高效训练。
  - 不使用池化层和全连接层：算法训练的模型要求网络输出与输入图像尺寸大小一致
  - 零填充（Zero-padding）：保持特征图尺寸不变。
  - BN层：加速训练，减少内部协变量偏移（Internal Covariate Shift）。

**目标函数与优化** 

- **目标函数**：$$L = \frac{1}{N} \sum \| H_k(X_j) - Y_q \|_F^2 + \lambda \sum \| W_i \|_F^2$$​
  - 均方误差（MSE）保证像素级重建精度。
  - L2正则化（λ=0.0001）防止过拟合。
- **优化策略**：反向传播算法、随机梯度下降法采用Adam算法，初始学习率0.1，每10个训练周期衰减1/10。

## 三、实验设计与结果分析 

### 研究问题

验证所提算法的有效性，将对合成的低照度图像和实际低照度图像分别进行实验，从客观和主观两方面进行对比分析

### 数据集构建

- **训练数据（训练集）**：使用500幅正常光照图像（计算机视觉领域的公开数据集 Berkeley Segmentation Dataset）Retinex模型合成256000个低照度图像块。
- **测试数据（测试集）**：
  - 合成数据：取计算机视觉领域LIVE1公开数据集29幅
  - 真实数据：NASA、DICM、VV数据库17幅

### 评价指标 

- **对比算法**：HE、Dong（去雾模型）、SRIE、LIME。
- **评价指标**：
  - **合成数据**：PSNR（峰值信噪比）、SSIM（结构相似性）、MSE（均方误差）、LOE（亮度顺序误差）。
  - **真实数据**：使用信息熵、色度改变度、VIF（视觉信息保真度）进行评价。（在对真实低照度图像进行客观评价时，由于没有相同场景的光照较好的图像作为参考，属于无参考客观质量评价范畴）

### 实验设置

- **实验环境**
  1. **硬件配置**
     - CPU：Intel Core i7-7700（4核，3.6 GHz）
     - GPU：NVIDIA GTX1070
     - 内存：16G
  2. **软件环境**
     - MatConvNet 1.0-beta25深度学习框架
     - MATLAB R2014a仿真平台
  
- **实验设计、步骤**

  1. **数据预处理**

     - **归一化**：将HSI空间的亮度分量（I）归一化至[0,1]。
     - **增强策略**：随机水平、垂直翻转，增加数据多样性。

  2. **模型训练流程**

     - **输入**：低照度图像块（40×40，亮度分量I）。
     - **输出**：增强后图像块（同尺寸）。
     - **训练步骤**：
     - **初始化**：卷积核权重采用He初始化，偏置初始化为0。
     - **批次训练**：
       - **批次大小（Batch Size）**：128（平衡显存占用与梯度稳定性）。
       - **训练周期（Epochs）**：50，每10个周期学习率衰减为原值的1/10。
     - **优化器**：Adam（初始学习率0.1）。
     - **正则化**：L2正则化（λ=0.0001），防止过拟合。

  3. **参数优化**

     - **卷积核尺寸**：对比1×1、3×3、5×5，最终选择3×3（PSNR提升0.35 dB，耗时合理）。
     - **卷积核初始化**：采用Kaiming He等人的针对 ReLU/PReLU 激活函数的权重初始化策略，偏置项初始化为０
     - **网络深度**：测试3、5、7、9层，7层效果最优（PSNR 22.31 dB）。
     - **卷积核数量**：测试32、64个卷积核数目，考虑模型性能和计算量，特征提取层64，非线性映射层64，重建层1。

     - **BN层设置**：移除BN后，PSNR下降，收敛速度降低。
     - **HSI vs RGB**：文中对比了HSI模型和RGB模型的图像增强对效果，将RHB转换为HSI训练PSNR提高，色度失真减少。


### 实验结果 

实验分别在 **合成低照度图像** 和 **真实低照度图像** 上进行测试，比较了多种经典算法：

- HE（直方图均衡化）
- Dong（去雾模型）
- SRIE（加权变分模型）
- LIME（基于光照估计的增强）

1. 合成低照度图像
   - **主观视觉**：本文方法增强后的图像亮度提升明显，且色彩保持较好，与原图像的更接近，相较SRIE方法亮度提升效果更好，而 Dong 方法易出现边缘伪影，LIME 方法易导致过增强。
   - **客观指标**（PSNR/SSIM/MSE/LOE）：
     - 论文方法在 PSNR、MSE、LOE 上均优于其他算法，仅SSIM 略低于 SRIE。
     - 说明增强后的图像更加接近真实亮度分布，且亮度顺序更自然。
2. 真实低照度图像

- 主观视觉：
  - HE 方法导致严重的色偏（泛白或泛黄）。
  - Dong 方法在边缘产生黑色伪影，SRIE 方法增强效果有限。
  - LIME 方法提高亮度，但存在过增强和色彩失真问题。
  - 论文方法在亮度提升的同时，色彩保持较好，且无明显伪影。

- 客观指标（信息熵/色度改变/LOE/VIF）：
  - 本文方法在色彩保持（色度改变值最低）、亮度自然度（LOE 最低）和视觉质量（VIF 最高）方面表现最佳。
  - LIME 方法的信息熵最高，表明增强后的细节最丰富，但 LOE 过高，导致亮度顺序不自然。
  - 论文算法除了信息熵低于 LIME 算法，在其他三个评价指标上均优于其他算法的，说明利用论文算法增强后的图像色彩保持较好,具有更好的自然度

综上，论文方法通过HSI空间分离单独增强亮度分量I，并与DCNN结合，在亮度提升、色彩保持、细节恢复上优于传统方法，验证了深度学习在低照度增强中的潜力。

## **五、局限性及改进方向** 
1. **局限性** 
   - **非均匀光照处理不足**：对光照突变区域（如强阴影）增强效果有限。
   - **训练数据局限性**：合成数据与真实低照度场景存在分布差异。
   - **计算效率**：40×40图像块处理需拼接，边缘可能不连续。
   - **实验仅基于 MatConvNet：**
2. **改进方向** 
   - **局部自适应增强**：引入注意力机制，动态调整增强强度。
   - **多模态数据融合**：结合红外或深度信息提升暗区细节。
   - **端到端优化**：设计联合损失函数（如感知损失+对抗损失）。
   - **提升模型可扩展性**：未来可尝试基于 PyTorch 或 TensorFlow 实现，以提高模型可扩展性。

## **六、总结与启示** 
论文通过**颜色空间解耦**与**深度卷紧神经网络**的协同创新，使用轻量化神经网络设计，在低照度增强任务中实现了色彩保真与细节恢复的平衡。其方法论为复杂视觉任务的属性解耦与高效模型设计提供了重要范式，同时也揭示了深度网络在宽度扩展与多模态融合中的潜力。

#### 颜色空间转换的有效性

原文通过 **HSI 颜色空间解耦图像属性**，显著降低了学习复杂度并抑制色彩失真，其核心机制包括：

- **亮度分量（I）独立增强**：
  仅对 HSI 空间的亮度分量进行增强，避免直接处理 RGB 通道间的强相关性（如同时调整RGB值易导致色彩偏移）。实验表明，该方法使色度改变度降至 0.0032，远优于直接对RGB空间处理的增强算法。
- **色彩保持与动态范围扩展**：
  通过保持 H（色度）和 S（饱和度）不变，确保增强后图像的色彩自然性（图 6 对比）。同时，亮度分量的动态范围通过 DCNN 增强，暗区细节显著提升（如人脸、树木等区域的可见性，图 4、图 6）。

**启示**：

- **解耦图像属性**可简化任务复杂度，尤其适用于需保持特定特征的场景（如医学图像增强需保留组织结构）。
- **跨模态学习潜力**：类似思路可扩展至其他颜色空间（如 Lab）或多光谱数据，增强特定频段信息。

#### **轻量化网络设计的意义**

原文提出**无池化层和全连接层的深度卷积网络（DCNN）**，通过以下设计实现高效局部特征增强：

- **零填充（Zero-padding）保持特征图尺寸**：
  避免池化操作导致的信息丢失，确保局部亮度调整的连续性。网络深度虽达7层，但因无池化层，特征图尺寸恒定，暗区细节得以保留。
- **参数效率与计算优化**：
  采用 3×3 小卷积核，在减少参数量的同时捕捉局部对比度变化。实验显示，模型在 NVIDIA GTX1070 上单周期训练仅需 2.5 小时（总训练时间约 125 小时），兼顾效率与精度。

**启示**：

- **轻量化结构适配边缘计算**：无池化设计适合移动端或嵌入式设备部署，实时处理低照度图像。
- **局部增强与全局协调的平衡**：通过分块训练避免整图增强的伪影问题，但需解决块间拼接的一致性）。

