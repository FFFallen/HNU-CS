# 第18章（1-3）

## 18-1

**1．在做地址转换之前，让我们用模拟器来研究线性页表在给定不同参数的情况下如何**

**改变大小。在不同参数变化时，计算线性页表的大小。一些建议输入如下，通过使用-v 标**

**志，你可以看到填充了多少个页表项。**

首先，要理解线性页表大小如何随着地址空间的增长而变化：

paging-linear-translate.py -P 1k -a 1m -p 512m -v -n 0 

paging-linear-translate.py -P 1k -a 2m -p 512m -v -n 0 

paging-linear-translate.py -P 1k -a 4m -p 512m -v -n 0 

然后，理解线性页面大小如何随页大小的增长而变化：

paging-linear-translate.py -P 1k -a 1m -p 512m -v -n 0 

paging-linear-translate.py -P 2k -a 1m -p 512m -v -n 0 

paging-linear-translate.py -P 4k -a 1m -p 512m -v -n 0 

**在运行这些命令之前，请试着想想预期的趋势。页表大小如何随地址空间的增长而改**

**变？随着页大小的增长呢？为什么一般来说，我们不应该使用很大的页呢？**

(1) 页表大小 = 地址空间大小 / 页大小

所以上述输入会填充的页表项数量分别为：

1m / 1k = 1024

2m / 1k = 2048

4m / 1k = 4096

1m / 2k = 512

1m / 4k = 256

可以发现页表大小随地址空间的增长而增长，随着页的大小增长和减少；

(2) 如果用很大的页可能会生成大量的内存碎片，导致地址空间被浪费。

## 18-2

**2．现在让我们做一些地址转换。从一些小例子开始，使用-u 标志更改分配给地址空间**

的页数。例如：

paging-linear-translate.py -P 1k -a 16k -p 32k -v -u 0 

paging-linear-translate.py -P 1k -a 16k -p 32k -v -u 25 

paging-linear-translate.py -P 1k -a 16k -p 32k -v -u 50 

paging-linear-translate.py -P 1k -a 16k -p 32k -v -u 75 

paging-linear-translate.py -P 1k -a 16k -p 32k -v -u 100 

如果增加每个地址空间中的页的百分比，会发生什么？

(1) 增加每个地址空间中的页的百分比，有效页的数量会增加。

## 18-3

**3．现在让我们尝试一些不同的随机种子，以及一些不同的（有时相当疯狂的）地址空间参数：**

paging-linear-translate.py -P 8 -a 32 -p 1024 -v -s 1 

paging-linear-translate.py -P 8k -a 32k -p 1m -v -s 2 

paging-linear-translate.py -P 1m -a 256m -p 512m -v -s 3 

哪些参数组合是不现实的？为什么？<img src="截屏2024-04-29 下午8.13.51.png" alt="截屏2024-04-29 下午8.13.51" style="zoom:67%;" />

根据设置的参数，地址空间大小为32字节，页大小为8字节，所以虚拟地址有5位，其中3位表示页偏移量（offset），其余2位表示虚拟页号（VPN）。



 VA 0x0000000e (decimal:    14) --> PA or invalid address

虚拟地址0x0000000e转换为5位二进制：**01 110**

01说明该地址在**1号虚拟页**，偏移量为**6**

查看1号虚拟页的最高字节为1，是有效页，其映射的物理页号为0x61(110 0001），所以最终的转换的物理地址为**110 0001 110**即**0x30e**



 VA 0x00000014 (decimal:    20) --> PA or invalid address?

虚拟地址0x00000014转换为二进制：**10 100**

10说明该地址在**2号虚拟页**，偏移量为**4**

查看2号虚拟页的最高字节为0，是无效页，所以该虚拟地址为 **invalid address**



 VA 0x00000019 (decimal:    25) --> PA or invalid address？

虚拟地址0x00000019转换为二进制：**11 001**

11说明该地址在**3号虚拟页**，偏移量为**1**

查看3号虚拟页的最高字节为0，是无效页，所以该虚拟地址为 **invalid address**



 VA 0x00000003 (decimal:    3) --> PA or invalid address?

虚拟地址0x00000003转换为二进制：**00 011**

00说明该地址在**0号虚拟页**，偏移量为**3**



查看0号虚拟页的最高字节为0，是无效页，所以该虚拟地址为 **invalid address**

 VA 0x00000000 (decimal:    0) --> PA or invalid address?

虚拟地址0x00000000转换为二进制：**00 000**

00说明该地址在**0号虚拟页**，偏移量为**0**

查看0号虚拟页的最高字节为0，是无效页，所以该虚拟地址为 **invalid address**

<img src="截屏2024-04-29 下午9.05.23.png" alt="截屏2024-04-29 下午9.05.23" style="zoom:67%;" />

根据设置的参数，地址空间大小为32k，页大小为8k，所以虚拟地址有15位，其中13位表示页偏移量（offset），其余2位表示虚拟页号（VPN）。

 VA 0x000055b9 (decimal:  21945) --> PA or invalid address?

虚拟地址0x000055b9转换为15位二进制：**10 1 0101 1011 1001**

10说明该地址在**2号虚拟页**，偏移量为**0x1559**

查看2号虚拟页的最高字节为0，是无效页，所以该虚拟地址为 **invalid address**



 VA 0x00002771 (decimal:  10097) --> PA or invalid address?

虚拟地址0x00002771转换为15位二进制：**01 0 0111 0111 0001**

01说明该地址在**1号虚拟页**，偏移量为**0x771**

查看1号虚拟页的最高字节为0，是无效页，所以该虚拟地址为 **invalid address**



 VA 0x00004d8f (decimal:  19855) --> PA or invalid address?

虚拟地址0x00004d8f转换为15位二进制：**10 0 1101 1000 1111**

10说明该地址在**2号虚拟页**，偏移量为**0xd8f**

查看2号虚拟页的最高字节为0，是无效页，所以该虚拟地址为 **invalid address**



 VA 0x00004dab (decimal:  19883) --> PA or invalid address?

虚拟地址0x00004dab转换为5位二进制：**10 0 1101 1010 1011**

10说明该地址在**2号虚拟页**，偏移量为**0xdab**

查看2号虚拟页的最高字节为0，是无效页，所以该虚拟地址为 **invalid address**



 VA 0x00004a64 (decimal:  19044) --> PA or invalid address?

虚拟地址0x00004a64转换为5位二进制：**10 0 1010 0110 0100**

10说明该地址在**2号虚拟页**，偏移量为**0xa64**

查看2号虚拟页的最高字节为0，是无效页，所以该虚拟地址为 **invalid address**



<img src="截屏2024-04-29 下午9.07.02.png" alt="截屏2024-04-29 下午9.07.02" style="zoom:67%;" />

<img src="截屏2024-04-29 下午9.07.44.png" alt="截屏2024-04-29 下午9.07.44" style="zoom:67%;" />

根据设置的参数，地址空间大小为256m，页大小为1m，所以虚拟地址有28位，其中20位表示页偏移量（offset），其余8位表示虚拟页号（VPN）。

这组参数组合是不现实的，因为页太大，会有很多空间被浪费。