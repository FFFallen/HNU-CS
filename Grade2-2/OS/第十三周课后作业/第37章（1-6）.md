# 第37章（1-6）

本作业使用 disk.py 来帮助读者熟悉现代磁盘的工作原理。它有很多不同的选项，与大多数其他模拟不同，它有图形动画，可以准确显示磁盘运行时发生的情况。详情请参阅README 文件。

## Q1

计算以下几组请求的寻道、旋转和传输时间: -a 0，-a 6，-a 30，-a 7，30，8，最后计算-a 10,11,12,13

### (1)-a 0:

<img src="截屏2024-06-09 下午5.50.28.png" alt="截屏2024-06-09 下午5.50.28" style="zoom:67%;" />

根据打印的参数来看

该磁盘的寻道速度为每时间单位1个磁道；

旋转速度为每时间单位1度

采取的策略为FIFO

有三个磁道，每个磁道都有12个扇区，每个扇区大小都是30度

使用-G标志运行可得到磁盘图像：

<img src="截屏2024-06-09 下午5.48.56.png" alt="截屏2024-06-09 下午5.48.56" style="zoom: 35%;" />

可以看到磁头的起始位置在最外部磁道的扇区6的一半，由README知磁盘按逆时针方向旋转。

而扇区0和扇区6在同一磁道上，所以寻道时间seek time = 0

按每个时间单位旋转1度的速度，要从扇区6中间沿逆时针转到扇区0起始位置需要转5.5(5个半扇区) * 30 = 165个时间单位，所以旋转时间 = 165

传输时间为磁头读取完整个扇区0的时间 = 30

综上，寻道、旋转和传输时间分别为为**0，165，30**

以相同方法分析-a 6，-a 30：

### (2)-a 6:

<img src="截屏2024-06-09 下午7.53.32.png" alt="截屏2024-06-09 下午7.53.32" style="zoom:67%;" />

<img src="截屏2024-06-09 下午7.53.09.png" alt="截屏2024-06-09 下午7.53.09" style="zoom:35%;" />

寻道时间：0

旋转时间：345

传输时间：30

### (3)-a 30:

<img src="截屏2024-06-09 下午7.55.24.png" alt="截屏2024-06-09 下午7.55.24" style="zoom:67%;" />

<img src="截屏2024-06-09 下午7.55.40.png" alt="截屏2024-06-09 下午7.55.40" style="zoom:35%;" />

阅读README可知，默认情况下每条轨道之间的距离为40个距离单位，扇区30在最内层磁道上，所以寻道时间为80

在寻道的同时磁盘也在旋转，80个时间单位后，磁道旋转了80度，所以当寻道完成后，磁头应位于扇区33，扇区33和扇区30相隔了8个扇区（34，35，24，25，26，27，28，29），所以还需旋转270 - 5 = 265度，所以旋转时间为265个时间单位

传输时间为30

综上，寻道、旋转和传输时间分别为为**80，265，30**

### (4)-a 7，30，8

磁盘调度策略为FIFO，所以寻道、旋转、传输时间如下：

| 扇区 | 寻道时间 | 旋转时间 | 传输时间 |
| ---- | -------- | -------- | -------- |
| 7    | 0        | 15       | 30       |
| 30   | 80       | 220      | 30       |
| 8    | 80       | 310      | 30       |

### (5)-a 10,11,12,13

| 扇区 | 寻道时间 | 旋转时间 | 传输时间 |
| ---- | -------- | -------- | -------- |
| 10   | 0        | 105      | 30       |
| 11   | 0        | 0        | 30       |
| 12   | 40       | 320      | 30       |
| 13   | 0        | 0        | 30       |

## Q2

执行上述相同请求,但将寻道速率更改为不同值:-S 2,-S 4,-S 8, -S 10,-S 40, -S 0.1。时间如何变化?

### (1)-a 0:

寻道时间：0

旋转时间：105

传输时间：30

### (2)-a 6:

寻道时间：0

旋转时间：345

传输时间：30

### (3)-a 30:

- **-S 2：**

寻道时间：40

旋转时间：305

传输时间：30

总时间：375

- **-S 4:**

寻道时间：20

旋转时间：325

传输时间：30

总时间：375

- **-S 40**

寻道时间：2

旋转时间：343

传输时间：30

总时间：375

- **-S 0.1:**

寻道时间：800

旋转时间：265

传输时间：30

总时间：1095

寻道速率增大，寻道时间减少，但旋转时间增加，但总时间不变，但寻道速率减慢到特别慢，总时间会因寻道时间而大幅延长。

### (4)-a 7，30，8:

- **-S 2：**

| 扇区       | 寻道时间 | 旋转时间 | 传输时间 | 总时间 |
| ---------- | -------- | -------- | -------- | ------ |
| 7          | 0        | 15       | 30       | 45     |
| 30         | 40       | 260      | 30       | 330    |
| 8          | 40       | 350      | 30       | 420    |
| **总时间** | 80       | 625      | 90       | 795    |

- **-S 4:**

| 扇区       | 寻道时间 | 旋转时间 | 传输时间 | 总时间 |
| ---------- | -------- | -------- | -------- | ------ |
| 7          | 0        | 15       | 30       | 45     |
| 30         | 20       | 280      | 30       | 330    |
| 8          | 20       | 10       | 30       | 60     |
| **总时间** | 40       | 305      | 90       | 435    |

- **-S 40:**

| 扇区       | 寻道时间 | 旋转时间 | 传输时间 | 总时间 |
| ---------- | -------- | -------- | -------- | ------ |
| 7          | 0        | 15       | 30       | 45     |
| 30         | 2        | 298      | 30       | 330    |
| 8          | 2        | 28       | 30       | 60     |
| **总时间** | 4        | 341      | 90       | 435    |

- **-S 0.1**

| 扇区       | 寻道时间 | 旋转时间 | 传输时间 | 总时间 |
| ---------- | -------- | -------- | -------- | ------ |
| 7          | 0        | 15       | 30       | 45     |
| 30         | 800      | 220      | 30       | 1050   |
| 8          | 800      | 310      | 30       | 1140   |
| **总时间** | 1600     | 545      | 90       | 2235   |

寻道速率增大，寻道时间减少，旋转时间增加，但总时间可能减少，但寻道速率减慢到特别慢，总时间会因寻道时间而大幅延长。

### (5)-a 10,11,12,13:

- **-S 2**

| 扇区       | 寻道时间 | 旋转时间 | 传输时间 | 总时间 |
| ---------- | -------- | -------- | -------- | ------ |
| 10         | 0        | 105      | 30       | 135    |
| 11         | 0        | 0        | 30       | 30     |
| 12         | 20       | 340      | 30       | 390    |
| 13         | 0        | 0        | 30       | 30     |
| **总时间** | 20       | 445      | 120      | 585    |

- **-S 4**

| 扇区       | 寻道时间 | 旋转时间 | 传输时间 | 总时间 |
| ---------- | -------- | -------- | -------- | ------ |
| 10         | 0        | 105      | 30       | 135    |
| 11         | 0        | 0        | 30       | 30     |
| 12         | 10       | 350      | 30       | 390    |
| 13         | 0        | 0        | 30       | 30     |
| **总时间** | 10       | 455      | 120      | 585    |

- **-S 40**

| 扇区       | 寻道时间 | 旋转时间 | 传输时间 | 总时间 |
| ---------- | -------- | -------- | -------- | ------ |
| 10         | 0        | 105      | 30       | 135    |
| 11         | 0        | 0        | 30       | 30     |
| 12         | 1        | 359      | 30       | 390    |
| 13         | 0        | 0        | 30       | 30     |
| **总时间** | 1        | 464      | 120      | 585    |

- **-S 0.1**

| 扇区       | 寻道时间 | 旋转时间 | 传输时间 | 总时间 |
| ---------- | -------- | -------- | -------- | ------ |
| 10         | 0        | 105      | 30       | 135    |
| 11         | 0        | 0        | 30       | 30     |
| 12         | 400      | 320      | 30       | 750    |
| 13         | 0        | 0        | 30       | 30     |
| **总时间** | 400      | 425      | 120      | 945    |

## Q3

同样的请求,但改变旋转速率:-R 0.1,-R 0.5,-R 0.01。时间如何变化?

### (1)-a 0:

- **-R 0.1**

寻道时间：0

旋转时间：5.5*30 / 0.1 = 1650

传输时间：30 / 0.1 = 300

- **-R 0.5**

寻道时间：0

旋转时间：5.5*30 / 0.5 = 3300

传输时间：30 / 0.5 = 600

- **-R 0.01**

寻道时间：0

旋转时间：5.5*30 / 0.01 = 16500

传输时间：30 / 0.01 = 3000

### (2)-a 6:

- **-R 0.1**

寻道时间：0

旋转时间：11.5*30 / 0.1 = 3450

传输时间：300

- **-R 0.5**

寻道时间：0

旋转时间：11.5*30 / 0.5 = 690

传输时间：600

- **-R 0.01**

寻道时间：0

旋转时间：11.5*30 / 0.01 = 34500

传输时间：3000

### (3)-a 30:

- **-R 0.1**

寻道时间：80

旋转时间：(360 - 23) / 0.1 = 3370

传输时间：300

- **-R 0.5**

寻道时间：80

旋转时间：(360 - 19)  / 0.5 = 674

传输时间：600

- **-R 0.01**

寻道时间：80

旋转时间：11.5*30 / 0.01 = 33700

传输时间：3000

### (4)-a 7，30，8:

- **-R 0.1：**

| 扇区       | 寻道时间 | 旋转时间 | 传输时间 | 总时间 |
| ---------- | -------- | -------- | -------- | ------ |
| 7          | 0        | 150      | 300      | 450    |
| 30         | 80       | 2920     | 300      | 3300   |
| 8          | 80       | 220      | 300      | 600    |
| **总时间** | 160      | 3290     | 900      | 450    |

- **-R 0.5：**

| 扇区       | 寻道时间 | 旋转时间 | 传输时间 | 总时间 |
| ---------- | -------- | -------- | -------- | ------ |
| 7          | 0        | 30       | 60       | 90     |
| 30         | 80       | 520      | 60       | 660    |
| 8          | 80       | 700      | 60       | 840    |
| **总时间** | 160      | 1250     | 180      | 1590   |

- **-R 0.01：**

| 扇区       | 寻道时间 | 旋转时间 | 传输时间 | 总时间 |
| ---------- | -------- | -------- | -------- | ------ |
| 7          | 0        | 1500     | 3000     | 4500   |
| 30         | 80       | 29920    | 3000     | 33000  |
| 8          | 80       | 2920     | 3000     | 6000   |
| **总时间** | 80       | 34340    | 9000     | 43500  |

### (5)a 10,11,12,13:

- **-R 0.1**

| 扇区       | 寻道时间 | 旋转时间 | 传输时间 | 总时间 |
| ---------- | -------- | -------- | -------- | ------ |
| 10         | 0        | 1050     | 300      | 1350   |
| 11         | 0        | 0        | 300      | 300    |
| 12         | 40       | 3560     | 300      | 3900   |
| 13         | 0        | 0        | 300      | 300    |
| **总时间** | 40       | 4610     | 1200     | 5850   |

- **-R 0.5**

| 扇区       | 寻道时间 | 旋转时间 | 传输时间 | 总时间 |
| ---------- | -------- | -------- | -------- | ------ |
| 10         | 0        | 105      | 30       | 135    |
| 11         | 0        | 0        | 30       | 30     |
| 12         | 40       | 350      | 30       | 390    |
| 13         | 0        | 0        | 30       | 30     |
| **总时间** | 40       | 455      | 120      | 585    |

- **-R 0.01**

| 扇区       | 寻道时间 | 旋转时间 | 传输时间 | 总时间 |
| ---------- | -------- | -------- | -------- | ------ |
| 10         | 0        | 10500    | 3000     | 13500  |
| 11         | 0        | 0        | 3000     | 3000   |
| 12         | 40       | 35960    | 3000     | 39000  |
| 13         | 0        | 0        | 3000     | 3000   |
| **总时间** | 40       | 46460    | 12000    | 58500  |

根据以上几组请求的情况，旋转速率的减慢使旋转时间和传输时间大幅增加，尽管因为寻道很快，旋转角度可能小一些，但旋转时间还是很长。

## Q4

你可能已经注意到,对于一些请求流,一些策略比 FIFO 更好。例如,对于请求流 -a 7,30,8,处理请求的顺序是什么?现在在相同的工作负载上运行最短寻道时间优先 (SSTF)调度程序(-p SSTF)。每个请求服务需要多长时间(寻道、旋转、传输)?

FIFO策略是先处理先发出处理请求的扇区，所以对于请求流 -a 7,30,8,处理请求的顺序是：7->30->8

**SSTF(处理请求的顺序从上至下）:**

| 扇区       | 寻道时间 | 旋转时间 | 传输时间 | 总时间 |
| ---------- | -------- | -------- | -------- | ------ |
| 7          | 0        | 15       | 30       | 45     |
| 8          | 0        | 0        | 30       | 30     |
| 30         | 80       | 190      | 30       | 300    |
| **总时间** | 80       | 205      | 90       | 375    |

<img src="截屏2024-06-10 上午11.26.17.png" alt="截屏2024-06-10 上午11.26.17" style="zoom:67%;" />

可以看到使用SSTF策略可以减少一次寻道，从而大幅减少了处理请求的总时间

## Q5

现在做同样的事情,但使用最短的接入时间优先(SATF)调度程序(-p SATF)它是否对 -a 7,30,8 指定的一组请求有所不同?找到 SATF 明显优于 SSTF 的一组请求。出现显著差异的条件是什么?

**使用SATF：**

<img src="截屏2024-06-10 上午11.26.32.png" alt="截屏2024-06-10 上午11.26.32" style="zoom:67%;" />

可以发现对-a 7,30,8这一组请求SATF与SSTF并没什么不同。

但如果对于请求-a 8,25,5，可以发现使用SATF明显优于SSTF：

SSTF：

<img src="截屏2024-06-10 上午11.38.15.png" alt="截屏2024-06-10 上午11.38.15" style="zoom:67%;" />

SATF:

<img src="截屏2024-06-10 上午11.37.10.png" alt="截屏2024-06-10 上午11.37.10" style="zoom:67%;" />

出现显著差异的条件是旋转速率远远高于寻道速率，此时可以直接选择SSTF，但二者相差不大或是寻道速率远远高于旋转速率，则选择SATF会更好。

## Q6

你可能已经注意到,该磁盘没有特别好地处理请求流 -a 10,11,12,13。这是为什么? 你可以引入一个磁道偏斜来解决这个问题(-o skew,其中 skew 是一个非负整数)?考虑到默认寻道速率,偏斜应该是多少,才能尽量减少这一组请求的总时间?对于不同的寻道速率(例如,-S 2,-S 4)呢?一般来说,考虑到寻道速率和扇区布局信息,你能否写出一个公式来计算偏斜?

磁盘没有特别好地处理请求流 -a 10,11,12,13，是因为扇区10，扇区11在一个磁道，扇区12，扇区13在另一个磁道，而四个扇区在圆周上是连续的，处理10和11后需要一次寻道去处理12和13，寻道过程会让磁盘已经转过扇区12和扇区13的起始边界，需要磁盘多旋转一圈。

默认的寻道速率为1，寻道距离为40，旋转速率为1，一个扇区大小为30，要减少这一组的请求时间，就要让寻道时磁盘还没有旋转到扇区12，即让扇区11和扇区12在圆周上相隔2个扇区，所以偏斜量应为2。

<img src="截屏2024-06-10 上午11.54.25.png" alt="截屏2024-06-10 上午11.54.25" style="zoom:67%;" />

对于不同的寻道速率(例如,-S 2,-S 4)：

对于-S 2和-S 4的偏斜量都应为1

-S 2:

<img src="截屏2024-06-10 上午11.59.44.png" alt="截屏2024-06-10 上午11.59.44" style="zoom:67%;" />

-S 4:

<img src="截屏2024-06-10 下午12.00.35.png" alt="截屏2024-06-10 下午12.00.35" style="zoom:67%;" />

按照以上的分析，磁道偏斜的角度应该大于寻道时间内旋转过的角度，以减少请求的总时间。假设寻道速率为v，磁道间的距离为s，旋转速率为p，则寻道时间内旋转过的角度为p\*(s/v)。假设一个磁道有n个扇区，则一个扇区的角度为360/n，偏斜磁道数设为x，则有

`p*(s/v) < (360/n)*x`，x应该取使不等式成立的最小值。

因此可以使用以下公式计算磁道偏斜：
$$
x > [pns360v(pns/360v)]
$$
